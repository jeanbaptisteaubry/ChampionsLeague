{% extends 'base.html.twig' %}
{% block body %}
  <h1>Texte d'accueil</h1>
  {% if ok %}<p class="flash-ok">{{ ok }}</p>{% endif %}
  {% if error %}<p class="flash-err">{{ error }}</p>{% endif %}

  <form method="post" action="/admin/home-text" onsubmit="document.getElementById('home_text').value = document.getElementById('editor').innerHTML;">
    <input type="hidden" name="_csrf" value="{{ app.csrf }}">

    <div id="toolbar" style="margin-bottom:.5rem">
      <button type="button" data-cmd="bold"><b>Gras</b></button>
      <button type="button" data-cmd="italic"><i>Italique</i></button>
      <button type="button" data-cmd="underline"><u>Souligne</u></button>
      <button type="button" data-cmd="insertUnorderedList">â€¢ Liste</button>
      <button type="button" data-cmd="insertOrderedList">1. Liste</button>
      <button type="button" data-cmd="formatBlock" data-value="H2">H2</button>
      <button type="button" data-cmd="formatBlock" data-value="H3">H3</button>
      <button type="button" id="linkBtn">Lien</button>
      <button type="button" data-cmd="removeFormat">Nettoyer</button>
    </div>

    <div id="editor" contenteditable="true" style="border:1px solid #ccc; padding:.5rem; min-height:180px">{{ homeText|raw }}</div>
    <textarea id="home_text" name="home_text" rows="10" style="display:none">{{ homeText }}</textarea>
    <div style="margin-top:.5rem">
      <button type="submit">Enregistrer</button>
    </div>
  </form>

  <script>
  (function(){
    function exec(cmd, val){ document.execCommand(cmd, false, val || null); }
    document.getElementById('toolbar').addEventListener('click', function(e){
      var btn = e.target.closest('button'); if(!btn) return;
      var cmd = btn.getAttribute('data-cmd');
      if(!cmd) return;
      var val = btn.getAttribute('data-value') || null;
      exec(cmd, val);
    });
    document.getElementById('linkBtn').addEventListener('click', function(){
      var url = prompt('URL du lien (https://...)');
      if(url){ exec('createLink', url); }
    });
  })();
  </script>
{% endblock %}
