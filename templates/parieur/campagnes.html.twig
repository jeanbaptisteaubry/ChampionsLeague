{% extends 'base.html.twig' %}
{% block body %}
  <h1>Mes campagnes</h1>
  {% if ok %}<p class="flash-ok">{{ ok }}</p>{% endif %}
  {% if error %}<p class="flash-err">{{ error }}</p>{% endif %}

  <h2>Inscrit</h2>
  <ul>
    {% for c in enrolled %}
      <li>
        {{ c.libelle }}
        {% set lc = lockedByCampagne[c.idCampagnePari]|default(0) %}
        {% if lc > 0 %}<span title="Phases verrouillÃ©es"> ðŸ”’ {{ lc }}</span>{% endif %}
        <a href="/parieur/campagnes/{{ c.idCampagnePari }}" style="margin-left:.75rem; display:inline-block; padding:.4rem .75rem; border:1px solid #0a57; border-radius:6px; text-decoration:none; background:#eaf8ff; color:#003;">Voir</a>
        {% if c.gain is defined and c.gain is not null %}
          â€” Gain:
          <div style="white-space:pre-line">{{ c.gain|nl2br }}</div>
        {% endif %}
        {% set can = canUnsubscribe[c.idCampagnePari]|default(true) %}
        {% if can %}
          <form method="post" action="/parieur/campagnes/{{ c.idCampagnePari }}/desinscrire" style="display:inline" onsubmit="return confirm('Se dÃ©sinscrire de cette campagne ?');">
            <input type="hidden" name="_csrf" value="{{ app.csrf }}">
            <button style="margin-left:.5rem">Se dÃ©sinscrire</button>
          </form>
        {% endif %}
      </li>
    {% else %}
      <li>Aucune</li>
    {% endfor %}
  </ul>

  <h2>S'inscrire Ã  une campagne</h2>
  {% if available|length == 0 %}
    <p>Aucune campagne disponible.</p>
  {% else %}
    <form method="post" action="/parieur/campagnes">
      <input type="hidden" name="_csrf" value="{{ app.csrf }}">
      <select name="idCampagnePari">
        {% for c in available %}
          <option value="{{ c.idCampagnePari }}">{{ c.libelle }}{% if c.gain is defined and c.gain is not null %} â€” Gain: {{ c.gain|replace({'\n':' '}) }}{% endif %}</option>
        {% endfor %}
      </select>
      <button>S'inscrire</button>
    </form>
  {% endif %}
{% endblock %}
