{% extends 'base.html.twig' %}
{% block body %}
  <h1>Placer des paris &mdash; Phase #{{ idPhase }}</h1>
  <p>
    <a href="/parieur/campagnes/{{ idCampagne }}">&larr; Retour &agrave; la campagne</a>
    {% if closed or locked %}
      &mdash; <a href="/parieur/phases/{{ idPhase }}/resultats">Voir r&eacute;sultats des paris</a>
    {% endif %}
  </p>
  {% if ok %}<p class="flash-ok">{{ ok }}</p>{% endif %}
  {% if error %}<p class="flash-err">{{ error }}</p>{% endif %}
  {% if closed %}
    <p class="flash-err">Phase cl&ocirc;tur&eacute;e: les paris ne sont plus accept&eacute;s.</p>
  {% endif %}
  <div style="margin:.5rem 0; color:#555">
    Cl&ocirc;ture: {{ deadline|date('d/m/Y H:i', 'Europe/Paris') }} &mdash; Heure serveur: {{ "now"|date('d/m/Y H:i:s', 'Europe/Paris') }}
  </div>
  {% if items|length == 0 %}
    <p>Pas d&rsquo;&eacute;l&eacute;ment &agrave; parier</p>
  {% else %}
    <form method="post" action="/parieur/phases/{{ idPhase }}/parier">
      <input type="hidden" name="_csrf" value="{{ app.csrf }}">
      <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse">
        <thead>
          <tr>
            <th>&Agrave; parier</th>
            {% for i in 1..nb %}
              <th>{{ labels[i] ?? ('Valeur ' ~ i) }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
            <tr>
              <td>#{{ it.idAParier }} &mdash; {{ it.libellePari }}</td>
              {% for i in 1..nb %}
                {% set label = (labels[i] ?? ('Valeur ' ~ i)) %}
                {% set val = (existing[it.idAParier][i] ?? '') %}
                <td><input name="paris[{{ it.idAParier }}][{{ i }}]" value="{{ val }}" placeholder="{{ label }}" {% if closed or locked %}disabled{% endif %}></td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <div style="margin-top:.5rem">
        <button {% if closed or locked %}disabled{% endif %}>Enregistrer</button>
      </div>
    </form>
    {% if not locked %}
      <form method="post" action="/parieur/phases/{{ idPhase }}/verrouiller" style="margin-top:.5rem;">
        <input type="hidden" name="_csrf" value="{{ app.csrf }}">
        <button type="submit" {% if closed %}disabled{% endif %} onclick="return confirm('Verrouiller vos paris pour cette phase ? Vous ne pourrez plus les modifier.');">Verrouiller mes paris</button>
      </form>
    {% else %}
      <p class="flash-ok" style="margin-top:.5rem">Vous avez verrouill&eacute; vos paris. Vous pouvez consulter ceux des autres.</p>
    {% endif %}
  {% endif %}
{% endblock %}
